<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta charset="utf-8" />
  <title>RailsTreejs</title>
  <link rel="stylesheet" media="all" href="/assets/tree.css?body=1" data-turbolinks-track="true" />
<link rel="stylesheet" media="all" href="/assets/application.css?body=1" data-turbolinks-track="true" />
  <script src="/assets/jquery.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/jquery_ujs.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/turbolinks.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/jstree.min.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/tree.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/application.js?body=1" data-turbolinks-track="true"></script>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="lEXdBPyQU5t9BY/iEQKy9VbzDHfiRgY298KzfANcOyI=" />
  <link href="/assets/themes/default/style.min.css" rel="stylesheet" />

</head>
<body>

<h2>jstree プラグインの利用例</h2>
* ./app 以下 を Tree 表示する (ajax を利用)
<table>
  <thead>
  </thead>
  <tbody>
    <tr>
      <td width="400" valign="top" nowrap="nowrap">
        <div>
	  <button class="tree_btn" id="ajaxTree_open">open_all</button>
          <button class="tree_btn" id="ajaxTree_close">close_all</button>
          <br />
	   <input type="text" placeholder="try css" style="margin:8px; border-radius:4px;" id="ajaxTree-q" />(部分一致で逐次選択します)
          <div id="ajaxTree" class="jstree jstree-4 jstree-default jstree-default-small" role="tree" aria-activedescendant="/views/tree/index.html.erb"><ul class="jstree-container-ul jstree-striped jstree-no-dots jstree-wholerow-ul"><li role="treeitem" aria-expanded="true" id="/assets" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>assets</a><ul role="group" class="jstree-children"><li role="treeitem" aria-expanded="true" id="/assets/images" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>images</a><ul role="group" class="jstree-children"><li role="treeitem" id="/assets/images/file_sprite.png" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-png jstree-themeicon-custom"></i>file_sprite.png</a></li></ul></li><li role="treeitem" aria-expanded="true" id="/assets/javascripts" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>javascripts</a><ul role="group" class="jstree-children"><li role="treeitem" id="/assets/javascripts/application.js" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-js jstree-themeicon-custom"></i>application.js</a></li><li role="treeitem" aria-expanded="true" id="/assets/javascripts/default" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>default</a><ul role="group" class="jstree-children"><li role="treeitem" id="/assets/javascripts/default/32px.png" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-png jstree-themeicon-custom"></i>32px.png</a></li><li role="treeitem" id="/assets/javascripts/default/40px.png" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-png jstree-themeicon-custom"></i>40px.png</a></li><li role="treeitem" id="/assets/javascripts/default/style.css" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-css jstree-themeicon-custom"></i>style.css</a></li><li role="treeitem" id="/assets/javascripts/default/style.min.css" class="jstree-node  jstree-leaf" aria-selected="false"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-css jstree-themeicon-custom"></i>style.min.css</a></li><li role="treeitem" id="/assets/javascripts/default/throbber.gif" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-gif jstree-themeicon-custom"></i>throbber.gif</a></li></ul></li><li role="treeitem" id="/assets/javascripts/jstree.min.js" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-js jstree-themeicon-custom"></i>jstree.min.js</a></li><li role="treeitem" aria-expanded="true" id="/assets/javascripts/themes" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>themes</a><ul role="group" class="jstree-children"><li role="treeitem" aria-expanded="true" id="/assets/javascripts/themes/default" class="jstree-node  jstree-open jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>default</a><ul role="group" class="jstree-children"><li role="treeitem" id="/assets/javascripts/themes/default/32px.png" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-png jstree-themeicon-custom"></i>32px.png</a></li><li role="treeitem" id="/assets/javascripts/themes/default/40px.png" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-png jstree-themeicon-custom"></i>40px.png</a></li><li role="treeitem" id="/assets/javascripts/themes/default/style.css" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-css jstree-themeicon-custom"></i>style.css</a></li><li role="treeitem" id="/assets/javascripts/themes/default/style.min.css" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-css jstree-themeicon-custom"></i>style.min.css</a></li><li role="treeitem" id="/assets/javascripts/themes/default/throbber.gif" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-gif jstree-themeicon-custom"></i>throbber.gif</a></li></ul></li></ul></li><li role="treeitem" id="/assets/javascripts/tree.js.coffee" class="jstree-node  jstree-leaf jstree-last" aria-selected="false"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-coffee jstree-themeicon-custom"></i>tree.js.coffee</a></li></ul></li><li role="treeitem" aria-expanded="true" id="/assets/stylesheets" class="jstree-node  jstree-open jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>stylesheets</a><ul role="group" class="jstree-children"><li role="treeitem" id="/assets/stylesheets/application.css" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-css jstree-themeicon-custom"></i>application.css</a></li><li role="treeitem" id="/assets/stylesheets/tree.css.scss" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-scss jstree-themeicon-custom"></i>tree.css.scss</a></li></ul></li></ul></li><li role="treeitem" aria-expanded="true" id="/controllers" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>controllers</a><ul role="group" class="jstree-children"><li role="treeitem" id="/controllers/application_controller.rb" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-rb jstree-themeicon-custom"></i>application_controller.rb</a></li><li role="treeitem" id="/controllers/concerns" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>concerns</a></li><li role="treeitem" id="/controllers/tree_controller.rb" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-rb jstree-themeicon-custom"></i>tree_controller.rb</a></li></ul></li><li role="treeitem" aria-expanded="true" id="/helpers" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>helpers</a><ul role="group" class="jstree-children"><li role="treeitem" id="/helpers/application_helper.rb" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-rb jstree-themeicon-custom"></i>application_helper.rb</a></li><li role="treeitem" id="/helpers/tree_helper.rb" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-rb jstree-themeicon-custom"></i>tree_helper.rb</a></li></ul></li><li role="treeitem" id="/mailers" class="jstree-node  jstree-leaf"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>mailers</a></li><li role="treeitem" aria-expanded="true" id="/models" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>models</a><ul role="group" class="jstree-children"><li role="treeitem" id="/models/concerns" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>concerns</a></li></ul></li><li role="treeitem" aria-expanded="true" id="/views" class="jstree-node  jstree-open jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>views</a><ul role="group" class="jstree-children"><li role="treeitem" aria-expanded="true" id="/views/layouts" class="jstree-node  jstree-open"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>layouts</a><ul role="group" class="jstree-children"><li role="treeitem" id="/views/layouts/application.html.erb" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon file file-erb jstree-themeicon-custom"></i>application.html.erb</a></li></ul></li><li role="treeitem" aria-expanded="true" id="/views/tree" class="jstree-node  jstree-open jstree-last"><div unselectable="on" class="jstree-wholerow"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>tree</a><ul role="group" class="jstree-children"><li role="treeitem" id="/views/tree/index.html.erb" class="jstree-node  jstree-leaf jstree-last" aria-selected="true"><div unselectable="on" class="jstree-wholerow jstree-wholerow-hovered jstree-wholerow-clicked"> </div><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor jstree-hovered jstree-clicked" href="#"><i class="jstree-icon jstree-themeicon file file-erb jstree-themeicon-custom"></i>index.html.erb</a></li></ul></li></ul></li></ul></div>
        </div>
      </td>
      <td valign="top">
	選択された項目: <span id="file_type">ファイル</span> <span id="selected">/views/tree/index.html.erb</span>
	<div id="file_contents_div" style="display: block;">内容：
	  <div id="file"><pre class="tree_pre" id="file_contents">&lt;h2&gt;jstree プラグインの利用例&lt;/h2&gt;
* ./app 以下 を Tree 表示する (ajax を利用)
&lt;table&gt;
  &lt;thead&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td width ="400" valign="top" nowrap&gt;
        &lt;div&gt;
	  &lt;button id="ajaxTree_open"  class="tree_btn"&gt;open_all&lt;/button&gt;
          &lt;button id="ajaxTree_close" class="tree_btn"&gt;close_all&lt;/button&gt;
          &lt;br/&gt;
	   &lt;input type="text" id="ajaxTree-q" style="margin:8px; border-radius:4px;" placeholder="try css"&gt;&lt;/input&gt;(部分一致で逐次選択します)
          &lt;div id="ajaxTree"&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      &lt;td valign="top"&gt;
	選択された項目: &lt;span id="file_type"&gt;&lt;/span&gt; &lt;span id="selected"&gt;&lt;/span&gt;
	&lt;div id="file_contents_div"&gt;内容：
	  &lt;div id="file"&gt;&lt;pre id="file_contents" class="tree_pre"&gt;&lt;/pre&gt;&lt;/div&gt;
	&lt;/div&gt;
      &lt;/td&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr/&gt;

* csv の内容
&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td width ="400" valign="top" nowrap&gt;
	階層化表示
	&lt;div&gt;
	  &lt;button id="ajaxTreeCsv_open"  class="tree_btn"&gt;open_all&lt;/button&gt;
	  &lt;button id="ajaxTreeCsv_close" class="tree_btn"&gt;close_all&lt;/button&gt;
	&lt;/div&gt;
	&lt;div id="ajaxTreeCsv"&gt;&lt;/div&gt;
      &lt;/td&gt;
      &lt;td  valign="top" nowrap&gt;
	CSV のファイル内容
	&lt;pre class="tree_pre"&gt;&lt;%= File.open('test/test.csv').read %&gt;&lt;/pre&gt;
      &lt;/td&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr/&gt;

* HTML List を Tree にする
&lt;div id="listTree"&gt;
  &lt;!-- in this example the tree is populated from inline HTML --&gt;
  &lt;ul&gt;
    &lt;li id="Root_1"&gt;Root node 1
      &lt;ul&gt;
        &lt;li id="child_node_1"&gt;Child node 1&lt;/li&gt;
        &lt;li id="child_node_2"&gt;Child node 2&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li id="Root_2"&gt;Root node 2
      &lt;ul&gt;
        &lt;li id="child_node_A"&gt;Child node A&lt;/li&gt;
        &lt;li id="child_node_B"&gt;Child node B&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;

* json データ を Tree にする
&lt;div&gt;
  &lt;div id="jsonTree"&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;hr/&gt;
&lt;pre&gt;
  * TODO:
  - javascript を別ファイルにする。coffeescript にする。
  - サーチプラグイン, チェックボックスプラグインを試す。

  * jstree の設定:
  http://www.jstree.com/docs/json/ の download の link から zip ファイルを落としてくる。
  落としてきた vakata-jstree-3.0.0-0-gb446e66.zip を展開して、
  themas/ と *.js を assets/javascritp/ に copy する。

&lt;script&gt;
  $(function () {
    $('#file_contents_div').hide()
    $('#listTree').jstree();

    $('#listTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
    });

    $('#jsonTree').jstree({
      'core' : {
        'data' : [
            { 'id': 'node_1', 'text': 'Root node',
              'children' : [
                  { 'id': 'node_1_1', 'text' : 'Child 1' },
                  { 'id': 'node_1_2', 'text' : 'Child 2'}
                ]
            },
            { 'id': 'node_2', 'text': 'Root node with options',
              'state' : { 'opened' : true, 'selected' : true },
              'children' : [
                  { 'id': 'node_2_1', 'text' : 'Child A' },
                  { 'id': 'node_2_2', 'text' : 'Child B'}
                ]
            }
        ]
      }
    });
    $('#jsonTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
    });

    // See http://www.jstree.com/demo/  Filebrowser demo
    $('#ajaxTree').jstree({
      'core': {
        'data': {
          'url': function (node) {
            return 'treeData.json?path';
          },
          'data': function (node) {
             return { 'id' : node.id };
          },
          'check_callback': true,
          'error': function (jqXHR, textStatus, errorThrown) {
                      alert("error. " + qXHR.responseText);
                    }
        },
        'themes': {
          'responsive' : false,
          'variant': 'small',
          'stripes' : true
        }
      },
      "types": {
        "file": {
          "icon": 'file'
        }
      },
      "plugins": [ "types", "sort", "search", "wholerow" ]
    });
    $('#ajaxTree_open').click(function() {
      $('#ajaxTree').jstree('open_all');
    });
    $('#ajaxTree_close').click(function() {
      $('#ajaxTree').jstree('close_all');
    });

    // クリックで tree の expand / collapse
    $("#ajaxTree").bind("select_node.jstree", function (e, data) {
      return data.instance.toggle_node(data.node);
    });

    $('#ajaxTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
      $('#file_contents_div').hide()
      $('#file_contents').text('')
      if (data.node.original.type == 'file') {
        $('#file_type').text('ファイル');
        show_filedata(data.node.original.id)
      } else {
        $('#file_type').text('ディレクター');
        clear_filedata()
      }
    });

    // path で指定された ./app 以下の ファイルの内容を ajax で得て、画面に表示する。
    // ./app 以下 以外のファイルが指定された時はエラーにすること。
    function show_filedata(path) {
      $.get('/fileData', { path: path },
        function(data) {
          $('#file_contents_div').show()
          $('#file_contents').text(data)
      });
    }

    function show_imagedata(path) {
    }

    function clear_filedata() {
      $('#file_contents_div').hide()
      $('#image_contents_div').hide()
      $('#file_contents').text('')
    }
  });

    $('#ajaxTreeCsv').jstree({
      'core': {
        'data': {
          'url': function (node) {
            return node.id === '#' ? 'treeDataCsv.json' : 'treeDataCsv.json';
          },
          'data' : function (node) {
             return { 'path' : 'test.csv' };
          }
        }
      },
      "types" : {
        "file" : {
          "icon" : 'jstree-file'
        }
      },
      "plugins" : [ "types" ]
    });

    var timeout = false;
    $('#ajaxTree-q').keyup(function () {
      if (timeout) {
        clearTimeout(timeout);
      }
      timeout = setTimeout(function () {
        var v = $('#ajaxTree-q').val();
        $('#ajaxTree').jstree(true).search(v);
      }, 250);
    });

    $('#ajaxTreeCsv').on("changed.jstree", function (e, data) {
      if (data.node.original.attr &amp;&amp; data.node.original.attr.val) {
        $('#csv_contents').text(data.node.original.attr.val)
      } else {
        $('#csv_contents').text('')
      }
    });
    $('#ajaxTreeCsv_open').click(function() {
      $('#ajaxTreeCsv').jstree('open_all');
    });
    $('#ajaxTreeCsv_close').click(function() {
      $('#ajaxTreeCsv').jstree('close_all');
    });
&lt;/script&gt;
</pre></div>
	</div>
      </td>
  </tr></tbody>
</table>
<hr />

* csv の内容
<table>
  <tbody>
    <tr>
      <td width="400" valign="top" nowrap="nowrap">
	階層化表示
	<div>
	  <button class="tree_btn" id="ajaxTreeCsv_open">open_all</button>
	  <button class="tree_btn" id="ajaxTreeCsv_close">close_all</button>
	</div>
	<div id="ajaxTreeCsv" class="jstree jstree-1 jstree-default jstree-default-responsive" role="tree"><ul class="jstree-container-ul"><li role="treeitem" id="/Title" class="jstree-node  jstree-leaf"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon jstree-file jstree-themeicon-custom"></i><strong>Title</strong>:	    key で階層構造を表現させた {key</a></li><li role="treeitem" aria-expanded="false" id="/A" class="jstree-node  jstree-closed"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i><strong>A</strong></a></li><li role="treeitem" aria-expanded="false" id="/B" class="jstree-node  jstree-closed jstree-last"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i><strong>B</strong></a></li></ul></div>
      </td>
      <td valign="top" nowrap="nowrap">
	CSV のファイル内容
	<pre class="tree_pre">Title,    key で階層構造を表現させた {key, val} の CSV データ
A1,       A_1
A2,       A_2
A2X,      A_2 X
A2B1,     A_2 B_1
A4B1C1,   A 411
A4B1C2,   A 412
B1,       B 1
B2,       B 2
B2X,      B 2 X
B2B1,     B 2 B 1
B4B1C1D1, B 4 1 1 1
B4B1C2D3, B 4 1 2 3</pre>
      </td>
  </tr></tbody>
</table>
<hr />

* HTML List を Tree にする
<div id="listTree" class="jstree jstree-2 jstree-default jstree-default-responsive" role="tree"><ul class="jstree-container-ul"><li role="treeitem" aria-expanded="false" id="Root_1" class="jstree-node  jstree-closed"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>Root node 1
      </a></li><li role="treeitem" aria-expanded="false" id="Root_2" class="jstree-node  jstree-closed jstree-last"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>Root node 2
      </a></li></ul></div>

* json データ を Tree にする
<div>
  <div id="jsonTree" class="jstree jstree-3 jstree-default jstree-default-responsive" role="tree"><ul class="jstree-container-ul"><li role="treeitem" aria-expanded="false" id="node_1" class="jstree-node  jstree-closed"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>Root node</a></li><li role="treeitem" aria-expanded="true" id="node_2" class="jstree-node  jstree-open jstree-last"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor  jstree-clicked" href="#"><i class="jstree-icon jstree-themeicon"></i>Root node with options</a><ul role="group" class="jstree-children"><li role="treeitem" id="node_2_1" class="jstree-node  jstree-leaf"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>Child A</a></li><li role="treeitem" id="node_2_2" class="jstree-node  jstree-leaf jstree-last"><i class="jstree-icon jstree-ocl"></i><a class="jstree-anchor" href="#"><i class="jstree-icon jstree-themeicon"></i>Child B</a></li></ul></li></ul></div>
</div>

<hr />
<pre>  * TODO:
  - javascript を別ファイルにする。coffeescript にする。
  - サーチプラグイン, チェックボックスプラグインを試す。

  * jstree の設定:
  http://www.jstree.com/docs/json/ の download の link から zip ファイルを落としてくる。
  落としてきた vakata-jstree-3.0.0-0-gb446e66.zip を展開して、
  themas/ と *.js を assets/javascritp/ に copy する。

<script>
  $(function () {
    $('#file_contents_div').hide()
    $('#listTree').jstree();

    $('#listTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
    });

    $('#jsonTree').jstree({
      'core' : {
        'data' : [
            { 'id': 'node_1', 'text': 'Root node',
              'children' : [
                  { 'id': 'node_1_1', 'text' : 'Child 1' },
                  { 'id': 'node_1_2', 'text' : 'Child 2'}
                ]
            },
            { 'id': 'node_2', 'text': 'Root node with options',
              'state' : { 'opened' : true, 'selected' : true },
              'children' : [
                  { 'id': 'node_2_1', 'text' : 'Child A' },
                  { 'id': 'node_2_2', 'text' : 'Child B'}
                ]
            }
        ]
      }
    });
    $('#jsonTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
    });

    // See http://www.jstree.com/demo/  Filebrowser demo
    $('#ajaxTree').jstree({
      'core': {
        'data': {
          'url': function (node) {
            return 'treeData.json?path';
          },
          'data': function (node) {
             return { 'id' : node.id };
          },
          'check_callback': true,
          'error': function (jqXHR, textStatus, errorThrown) {
                      alert("error. " + qXHR.responseText);
                    }
        },
        'themes': {
          'responsive' : false,
          'variant': 'small',
          'stripes' : true
        }
      },
      "types": {
        "file": {
          "icon": 'file'
        }
      },
      "plugins": [ "types", "sort", "search", "wholerow" ]
    });
    $('#ajaxTree_open').click(function() {
      $('#ajaxTree').jstree('open_all');
    });
    $('#ajaxTree_close').click(function() {
      $('#ajaxTree').jstree('close_all');
    });

    // クリックで tree の expand / collapse
    $("#ajaxTree").bind("select_node.jstree", function (e, data) {
      return data.instance.toggle_node(data.node);
    });

    $('#ajaxTree').on("changed.jstree", function (e, data) {
      // console.log(data.selected);
      $('#selected').text(data.selected);
      $('#file_contents_div').hide()
      $('#file_contents').text('')
      if (data.node.original.type == 'file') {
        $('#file_type').text('ファイル');
        show_filedata(data.node.original.id)
      } else {
        $('#file_type').text('ディレクター');
        clear_filedata()
      }
    });

    // path で指定された ./app 以下の ファイルの内容を ajax で得て、画面に表示する。
    // ./app 以下 以外のファイルが指定された時はエラーにすること。
    function show_filedata(path) {
      $.get('/fileData', { path: path },
        function(data) {
          $('#file_contents_div').show()
          $('#file_contents').text(data)
      });
    }

    function show_imagedata(path) {
    }

    function clear_filedata() {
      $('#file_contents_div').hide()
      $('#image_contents_div').hide()
      $('#file_contents').text('')
    }
  });

    $('#ajaxTreeCsv').jstree({
      'core': {
        'data': {
          'url': function (node) {
            return node.id === '#' ? 'treeDataCsv.json' : 'treeDataCsv.json';
          },
          'data' : function (node) {
             return { 'path' : 'test.csv' };
          }
        }
      },
      "types" : {
        "file" : {
          "icon" : 'jstree-file'
        }
      },
      "plugins" : [ "types" ]
    });

    var timeout = false;
    $('#ajaxTree-q').keyup(function () {
      if (timeout) {
        clearTimeout(timeout);
      }
      timeout = setTimeout(function () {
        var v = $('#ajaxTree-q').val();
        $('#ajaxTree').jstree(true).search(v);
      }, 250);
    });

    $('#ajaxTreeCsv').on("changed.jstree", function (e, data) {
      if (data.node.original.attr &amp;&amp; data.node.original.attr.val) {
        $('#csv_contents').text(data.node.original.attr.val)
      } else {
        $('#csv_contents').text('')
      }
    });
    $('#ajaxTreeCsv_open').click(function() {
      $('#ajaxTreeCsv').jstree('open_all');
    });
    $('#ajaxTreeCsv_close').click(function() {
      $('#ajaxTreeCsv').jstree('close_all');
    });
</script>




</pre><ul class="vakata-context"></ul><div id="jstree-marker" style="display: none;"> </div></body><canvas id="fxdriver-screenshot-canvas" style="display: none;" width="945" height="1700"></canvas></html>